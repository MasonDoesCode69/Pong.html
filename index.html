<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mark's 3D Dimension</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; color: #0ff; pointer-events: none; }
        #dialogue { position: absolute; bottom: 30px; width: 100%; text-align: center; color: #f0f; font-size: 20px; font-weight: bold; text-shadow: 0 0 10px #f0f; }
        .stats { position: absolute; top: 10px; left: 10px; color: #0ff; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="ui">
        <h1>3D NEON STRIKE</h1>
        <p>Use WASD to move. Knock Mark off the edge!</p>
    </div>
    <div id="dialogue">Mark: "Welcome to my 3D domain, player."</div>

    <!-- Load Three.js from CDN -->
    <script type="importmap">
        {
            "imports": {
                "three": "unpkg.com"
            }
        }
    </script>

<script type="module">
    import * as THREE from 'three';

    // --- SETUP ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    // --- LIGHTING ---
    const ambientLight = new THREE.AmbientLight(0x404040, 2);
    scene.add(ambientLight);
    const pointLight = new THREE.PointLight(0x00ffff, 10, 100);
    pointLight.position.set(0, 10, 0);
    scene.add(pointLight);

    // --- ARENA ---
    const floorGeo = new THREE.PlaneGeometry(50, 50);
    const floorMat = new THREE.MeshPhongMaterial({ color: 0x111111, side: THREE.DoubleSide });
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = Math.PI / 2;
    scene.add(floor);

    const grid = new THREE.GridHelper(50, 50, 0x00ffff, 0x222222);
    scene.add(grid);

    // --- PLAYERS ---
    const playerGeo = new THREE.SphereGeometry(1, 32, 32);
    const playerMat = new THREE.MeshPhongMaterial({ color: 0x00ffff, emissive: 0x00ffff });
    const player = new THREE.Mesh(playerGeo, playerMat);
    player.position.y = 1;
    player.position.x = -10;
    scene.add(player);

    const markGeo = new THREE.BoxGeometry(2, 2, 2);
    const markMat = new THREE.MeshPhongMaterial({ color: 0xff00ff, emissive: 0xff00ff });
    const mark = new THREE.Mesh(markGeo, markMat);
    mark.position.y = 1;
    mark.position.x = 10;
    scene.add(mark);

    // --- PHYSICS VARS ---
    let playerVel = new THREE.Vector3();
    let markVel = new THREE.Vector3();
    const friction = 0.95;
    const accel = 0.05;
    const keys = {};

    const dialogueBox = document.getElementById('dialogue');
    const markQuotes = [
        "I'm rendering your defeat in real-time.",
        "Your movement is so... linear.",
        "Calculated. Optimized. Superior.",
        "Error: Your skill not found in 3D space.",
        "I'm 1000 polygons ahead of you."
    ];

    window.addEventListener('keydown', (e) => keys[e.code] = true);
    window.addEventListener('keyup', (e) => keys[e.code] = false);

    function updateMark() {
        // Simple AI: Head toward player
        const dir = new THREE.Vector3().subVectors(player.position, mark.position).normalize();
        markVel.addScaledVector(dir, 0.03);
        
        mark.position.add(markVel);
        markVel.multiplyScalar(friction);

        // Rotation effect
        mark.rotation.y += 0.05;
        mark.rotation.x += 0.02;
    }

    function checkCollision() {
        const dist = player.position.distanceTo(mark.position);
        if (dist < 2) {
            // Bounce effect
            const bounce = new THREE.Vector3().subVectors(player.position, mark.position).normalize();
            playerVel.addScaledVector(bounce, 0.5);
            markVel.addScaledVector(bounce, -0.5);
            
            if(Math.random() > 0.7) {
                dialogueBox.innerText = `Mark: "${markQuotes[Math.floor(Math.random() * markQuotes.length)]}"`;
            }
        }
    }

    function animate() {
        requestAnimationFrame(animate);

        // Player Controls
        if (keys['KeyW'] || keys['ArrowUp']) playerVel.z -= accel;
        if (keys['KeyS'] || keys['ArrowDown']) playerVel.z += accel;
        if (keys['KeyA'] || keys['ArrowLeft']) playerVel.x -= accel;
        if (keys['KeyD'] || keys['ArrowRight']) playerVel.x += accel;

        player.position.add(playerVel);
        playerVel.multiplyScalar(friction);

        updateMark();
        checkCollision();

        // Fall Off Logic
        if (Math.abs(player.position.x) > 25 || Math.abs(player.position.z) > 25) {
            player.position.set(-10, 1, 0);
            dialogueBox.innerText = 'Mark: "Gravity is a harsh mistress, human."';
        }
        if (Math.abs(mark.position.x) > 25 || Math.abs(mark.position.z) > 25) {
            mark.position.set(10, 1, 0);
            dialogueBox.innerText = 'Mark: "I meant to do that. Calculating wind resistance."';
        }

        // Camera Follow
        camera.position.lerp(new THREE.Vector3(player.position.x, player.position.y + 10, player.position.z + 20), 0.1);
        camera.lookAt(player.position);

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
</script>
</body>
</html>
